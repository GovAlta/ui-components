import {
  Meta,
  Canvas,
  Story,
  Description,
  ArgsTable,
} from '@storybook/addon-docs';
import { moduleMetadata } from '@storybook/angular';
import { action } from '@storybook/addon-actions';

import { DoDont } from '@abgov/shared/storybook-common';

import { GoADropdownComponent } from './dropdown.component';
import { GoAOptionComponent } from './option/option.component';
import { GoAOptionGroupComponent } from './option-group/option-group.component';

import { OverlayModule } from '@angular/cdk/overlay';

<Meta
  title="Angular/Basic Elements/Dropdown"
  decorators={[
    moduleMetadata({
      imports: [OverlayModule],
      declarations: [
        GoADropdownComponent,
        GoAOptionComponent,
        GoAOptionGroupComponent,
      ],
    }),
  ]}
  component={GoADropdownComponent}
  argTypes={{
    label: { control: 'text' },
    description: { control: 'text' },
    typeaheadMode: {
      control: 'select',
      options: ['none', 'contains', 'startsWith'],
      defaultValue: 'none',
      table: {
        //tracked bug in storybook https://github.com/storybookjs/storybook/issues/11983, need table to override display
        defaultValue: { summary: 'none' },
      },
    },
    required: {
      control: 'boolean',
      table: {
        //tracked bug in storybook https://github.com/storybookjs/storybook/issues/11983, need table to override display
        defaultValue: { summary: false },
      },
    },
    disabled: {
      control: 'boolean',
      table: {
        //tracked bug in storybook https://github.com/storybookjs/storybook/issues/11983, need table to override display
        defaultValue: { summary: false },
        type: { summary: 'boolean' },
      },
    },
    multiple: {
      control: 'boolean',
      table: {
        //tracked bug in storybook https://github.com/storybookjs/storybook/issues/11983, need table to override display
        defaultValue: { summary: false },
      },
    },
    menuHeight: { control: 'number' },
    selectedIds: {
      type: { name: 'Array<string>', required: false },
      table: {
        //tracked bug in storybook https://github.com/storybookjs/storybook/issues/11983, need table to override display
        type: { summary: 'Array<string>' },
        defaultValue: { summary: undefined },
      },
    },
    selectionChange: {
      table: {
        type: { summary: 'EventEmitter<Array<any>>' },
      },
    },
  }}
/>

# Drop Down List

A user input field that allows the user one selected option from a large list of options.

## Overview

#### Basic

<Canvas>
  <Story
    name="Basic"
    height={400}
    args={{
      label: 'Fruits',
      description: 'Choose your favourite fruit!',
      typeaheadMode: 'none',
      required: false,
      disabled: false,
      multiple: false,
    }}
  >
    {(args) => {
      args.onSelectionChanged = function (value) {
        action('selection was changed')(value);
      };
      return {
        template: `<span style="width:300px;display:inline-block;">
                    <goa-dropdown
                        (selectionChange)="onSelectionChanged($event)"
                        [typeaheadMode]="typeaheadMode"
                        [menuHeight]="menuHeight"
                        [required]="required"
                        [disabled]="disabled"
                        [multiple]="multiple"
                        [label]="label"
                        [selectedIds]="selectedIds"
                        [description]="description">
                      <goa-option id='apples' [value]='{fruit: "apples"}' label="Apples">Apples</goa-option>
                      <goa-option id='oranges' [value]='{fruit: "oranges"}' label="Oranges"><span>Oranges üçä</span></goa-option>
                      <goa-option id='pears' [value]='{fruit: "pears"}' label="Pears">Pears</goa-option>
                      <goa-option id='plums' [value]='{fruit: "plums"}' label="Plums">Plums</goa-option>
                      <goa-option id='peaches' [value]='{fruit: "peaches"}' label="Peaches">Peaches</goa-option>
                      <goa-option id='watermelons' [value]='{fruit: "watermelons"}' label="Watermelon">Watermelon</goa-option>
                      <goa-option id='tomatoes' [value]='{fruit: "tomatoes"}' label="Tomatoes">Tomatoes</goa-option>
                      <goa-option id='papayas' [value]='{fruit: "papayas"}' label="Papayas">Papayas</goa-option>
                      <goa-option id='bananas' [value]='{fruit: "bananas"}' label="Bananas">Bananas</goa-option>
                      <goa-option id='pineapples' [value]='{fruit: "pineapples"}' label="Pineapples">Pineapples</goa-option>
                    </goa-dropdown>
                  </span>`,
        props: args,
      };
    }}
  </Story>
</Canvas>

#### Required

<Canvas>
  <Story
    name="Required"
    height={400}
    args={{
      label: 'Fruits',
      description: 'Choose your favourite fruit!',
      typeaheadMode: 'none',
      required: true,
      disabled: false,
      multiple: false,
    }}
  >
    {(args) => {
      args.onSelectionChanged = function (value) {
        action('selection was changed')(value);
      };
      return {
        template: `<span style="width:300px;display:inline-block;">
                    <goa-dropdown
                        (selectionChange)="onSelectionChanged($event)"
                        [typeaheadMode]="typeaheadMode"
                        [menuHeight]="menuHeight"
                        [required]="required"
                        [disabled]="disabled"
                        [multiple]="multiple"
                        [label]="label"
                        [selectedIds]="selectedIds"
                        [description]="description">
                      <goa-option id='apples' [value]='{fruit: "apples"}' label="Apples">Apples</goa-option>
                      <goa-option id='oranges' [value]='{fruit: "oranges"}' label="Oranges"><span>Oranges üçä</span></goa-option>
                      <goa-option id='pears' [value]='{fruit: "pears"}' label="Pears">Pears</goa-option>
                      <goa-option id='plums' [value]='{fruit: "plums"}' label="Plums">Plums</goa-option>
                      <goa-option id='peaches' [value]='{fruit: "peaches"}' label="Peaches">Peaches</goa-option>
                      <goa-option id='watermelons' [value]='{fruit: "watermelons"}' label="Watermelon">Watermelon</goa-option>
                      <goa-option id='tomatoes' [value]='{fruit: "tomatoes"}' label="Tomatoes">Tomatoes</goa-option>
                      <goa-option id='papayas' [value]='{fruit: "papayas"}' label="Papayas">Papayas</goa-option>
                      <goa-option id='bananas' [value]='{fruit: "bananas"}' label="Bananas">Bananas</goa-option>
                      <goa-option id='pineapples' [value]='{fruit: "pineapples"}' label="Pineapples">Pineapples</goa-option>
                    </goa-dropdown>
                  </span>`,
        props: args,
      };
    }}
  </Story>
</Canvas>

#### Initial Values

<Canvas>
  <Story
    name="Initial Values"
    height={400}
    args={{
      label: 'Fruits',
      description: 'Choose your favourite fruit!',
      typeaheadMode: 'none',
      required: false,
      disabled: false,
      multiple: false,
    }}
  >
    {(args) => {
      args.onSelectionChanged = function (value) {
        action('selection was changed')(value);
      };
      return {
        template: `<span style="width:300px;display:inline-block;">
                    <goa-dropdown
                        (selectionChange)="onSelectionChanged($event)"
                        [typeaheadMode]="typeaheadMode"
                        [menuHeight]="menuHeight"
                        [required]="required"
                        [disabled]="disabled"
                        [multiple]="multiple"
                        [label]="label"
                        [selectedIds]="selectedIds"
                        [description]="description">
                      <goa-option id='apples' [value]='{fruit: "apples"}' label="Apples">Apples</goa-option>
                      <goa-option id='oranges' [defaultSelected]="true" [value]='{fruit: "oranges"}' label="Oranges"><span>Oranges üçä</span></goa-option>
                      <goa-option id='pears' [value]='{fruit: "pears"}' label="Pears">Pears</goa-option>
                      <goa-option id='plums' [value]='{fruit: "plums"}' label="Plums">Plums</goa-option>
                      <goa-option id='peaches' [value]='{fruit: "peaches"}' label="Peaches">Peaches</goa-option>
                      <goa-option id='watermelons' [value]='{fruit: "watermelons"}' label="Watermelon">Watermelon</goa-option>
                      <goa-option id='tomatoes' [value]='{fruit: "tomatoes"}' label="Tomatoes">Tomatoes</goa-option>
                      <goa-option id='papayas' [value]='{fruit: "papayas"}' label="Papayas">Papayas</goa-option>
                      <goa-option id='bananas' [value]='{fruit: "bananas"}' label="Bananas">Bananas</goa-option>
                      <goa-option id='pineapples' [value]='{fruit: "pineapples"}' label="Pineapples">Pineapples</goa-option>
                    </goa-dropdown>
                  </span>`,
        props: args,
      };
    }}
  </Story>
</Canvas>

#### Disabled

<Canvas>
  <Story
    name="Disabled"
    height={400}
    args={{
      label: 'Fruits',
      description: 'Choose your favourite fruit!',
      typeaheadMode: 'none',
      required: false,
      disabled: true,
      multiple: false,
    }}
  >
    {(args) => {
      args.onSelectionChanged = function (value) {
        action('selection was changed')(value);
      };
      return {
        template: `<span style="width:300px;display:inline-block;">
                    <goa-dropdown
                        (selectionChange)="onSelectionChanged($event)"
                        [typeaheadMode]="typeaheadMode"
                        [menuHeight]="menuHeight"
                        [required]="required"
                        [disabled]="disabled"
                        [multiple]="multiple"
                        [label]="label"
                        [selectedIds]="selectedIds"
                        [description]="description">
                      <goa-option id='apples' [value]='{fruit: "apples"}' label="Apples">Apples</goa-option>
                      <goa-option id='oranges' [value]='{fruit: "oranges"}' label="Oranges"><span>Oranges üçä</span></goa-option>
                      <goa-option id='pears' [value]='{fruit: "pears"}' label="Pears">Pears</goa-option>
                      <goa-option id='plums' [value]='{fruit: "plums"}' label="Plums">Plums</goa-option>
                      <goa-option id='peaches' [value]='{fruit: "peaches"}' label="Peaches">Peaches</goa-option>
                      <goa-option id='watermelons' [value]='{fruit: "watermelons"}' label="Watermelon">Watermelon</goa-option>
                      <goa-option id='tomatoes' [value]='{fruit: "tomatoes"}' label="Tomatoes">Tomatoes</goa-option>
                      <goa-option id='papayas' [value]='{fruit: "papayas"}' label="Papayas">Papayas</goa-option>
                      <goa-option id='bananas' [value]='{fruit: "bananas"}' label="Bananas">Bananas</goa-option>
                      <goa-option id='pineapples' [value]='{fruit: "pineapples"}' label="Pineapples">Pineapples</goa-option>
                    </goa-dropdown>
                  </span>`,
        props: args,
      };
    }}
  </Story>
</Canvas>

#### Multi Selection

<Canvas>
  <Story
    name="Multi Selection"
    height={400}
    args={{
      label: 'Fruits',
      description: 'Choose your favourite fruit!',
      typeaheadMode: 'none',
      required: false,
      disabled: false,
      multiple: true,
    }}
  >
    {(args) => {
      args.onSelectionChanged = function (value) {
        action('selection was changed')(value);
      };
      return {
        template: `<span style="width:300px;display:inline-block;">
                    <goa-dropdown
                        (selectionChange)="onSelectionChanged($event)"
                        [typeaheadMode]="typeaheadMode"
                        [menuHeight]="menuHeight"
                        [required]="required"
                        [disabled]="disabled"
                        [multiple]="multiple"
                        [label]="label"
                        [selectedIds]="selectedIds"
                        [description]="description">
                      <goa-option id='apples' [value]='{fruit: "apples"}' label="Apples">Apples</goa-option>
                      <goa-option id='oranges' [value]='{fruit: "oranges"}' label="Oranges"><span>Oranges üçä</span></goa-option>
                      <goa-option id='pears' [value]='{fruit: "pears"}' label="Pears">Pears</goa-option>
                      <goa-option id='plums' [value]='{fruit: "plums"}' label="Plums">Plums</goa-option>
                      <goa-option id='peaches' [value]='{fruit: "peaches"}' label="Peaches">Peaches</goa-option>
                      <goa-option id='watermelons' [value]='{fruit: "watermelons"}' label="Watermelon">Watermelon</goa-option>
                      <goa-option id='tomatoes' [value]='{fruit: "tomatoes"}' label="Tomatoes">Tomatoes</goa-option>
                      <goa-option id='papayas' [value]='{fruit: "papayas"}' label="Papayas">Papayas</goa-option>
                      <goa-option id='bananas' [value]='{fruit: "bananas"}' label="Bananas">Bananas</goa-option>
                      <goa-option id='pineapples' [value]='{fruit: "pineapples"}' label="Pineapples">Pineapples</goa-option>
                    </goa-dropdown>
                  </span>`,
        props: args,
      };
    }}
  </Story>
</Canvas>

#### Groups

<Canvas>
  <Story
    name="Groups"
    height={400}
    args={{
      label: 'Fruits',
      description: 'Choose your favourite fruit!',
      typeaheadMode: 'none',
      required: false,
      disabled: false,
      multiple: false,
    }}
  >
    {(args) => {
      args.onSelectionChanged = function (value) {
        action('selection was changed')(value);
      };
      return {
        template: `<span style="width:300px;display:inline-block;">
                    <goa-dropdown (selectionChange)="selectionChanged($event)"
                        [required]="required"
                        [menuHeight]="menuHeight"
                        [typeaheadMode]="typeaheadMode"
                        [disabled]="disabled"
                        [multiple]="multiple"
                        [label]="label"
                        [description]="description">
                      <goa-option-group label="Group 1">
                        <goa-option id='apples' [value]='{fruit: "apples"}' label="Apples">Apples</goa-option>
                        <goa-option id='oranges' [defaultSelected]="true" [value]='{fruit: "oranges"}' label="Oranges"><span>Oranges üçä</span></goa-option>
                        <goa-option id='pears' [value]='{fruit: "pears"}' label="Pears">Pears</goa-option>
                      </goa-option-group>
                      <goa-option-group label="Group 2">
                        <goa-option id='plums' [value]='{fruit: "plums"}' label="Plums">Plums</goa-option>
                        <goa-option id='peaches' [value]='{fruit: "peaches"}' label="Peaches">Peaches</goa-option>
                        <goa-option id='watermelons' [value]='{fruit: "watermelons"}' label="Watermelons">Watermelon</goa-option>
                        <goa-option id='tomatoes' [value]='{fruit: "tomatoes"}' label="Tomatoes">Tomatoes</goa-option>
                        <goa-option id='papayas' [value]='{fruit: "papayas"}' label="Papayas">Papayas</goa-option>
                      </goa-option-group>
                      <goa-option id='bananas' [value]='{fruit: "bananas"}' label="Bananas">Bananas</goa-option>
                      <goa-option id='pineapples' [value]='{fruit: "pineapples"}' label="Pineapples">Pineapples</goa-option>
                    </goa-dropdown>
                  </span>`,
        props: args,
      };
    }}
  </Story>
</Canvas>

## Examples

Basic

```html
<goa-dropdown
  (selectionChange)="selectionChanged($event)"
  label="Fruits"
  description="Select your favourite fruit."
>
  <goa-option id="apples" [value]='{fruit: "apples"}' label="Apples"
    >Apples</goa-option
  >
  <goa-option id="oranges" [value]='{fruit: "oranges"}' label="Oranges"
    ><span>We can put icons or other markup</span></goa-option
  >
  <goa-option id="pears" [value]='{fruit: "pears"}' label="Pears"
    >Pears</goa-option
  >
</goa-dropdown>
```

With Grouping

```html
<goa-dropdown
  (selectionChange)="selectionChanged($event)"
  label="Fruits"
  description="Select your favourite fruit."
>
  <goa-option-group label="Group 1">
    <goa-option id="apples" [value]='{fruit: "apples"}' label="Apples"
      >Apples</goa-option
    >
    <goa-option id="oranges" [value]='{fruit: "oranges"}' label="Oranges"
      ><span>We can put icons or other markup</span></goa-option
    >
  </goa-option-group>
  <goa-option id="pears" [value]='{fruit: "pears"}' label="Pears"
    >Pears</goa-option
  >
</goa-dropdown>
```

Dynamic list

```html
<goa-dropdown
  (selectionChange)="selectionChanged($event)"
  label="Fruits"
  description="Select your favourite fruit."
>
  <goa-option
    *ngFor="let fruit of fruits"
    [id]="fruit.id"
    [value]="fruit"
    [label]="fruit.label"
    >{{fruit.label}}</goa-option
  >
</goa-dropdown>
```

## Properties

#### GoADropdownComponent

<Description of={GoADropdownComponent} />
<ArgsTable of={GoADropdownComponent} />

#### GoAOptionComponent

<Description of={GoAOptionComponent} />
<ArgsTable of={GoAOptionComponent} />

#### GoAOptionGroupComponent

<Description of={GoAOptionGroupComponent} />
<ArgsTable of={GoAOptionGroupComponent} />

## Usage guidelines

### Widths and character count

Drop down lists are responsive and range in width from 272 pixels on mobile up to 384 pixels
on desktop. Each option should be a brief word, description, or name.

<DoDont
  dos={'Limit character width to 20 characters per option.'}
  donts={'Use drop down lists for sentences.'}
/>

### Select a single option

Use drop down lists when the user can only select one option and when there are more than
seven available options to select from. Use radio buttons instead when there are seven or
less available options to choose from. Since all the options but one are hidden, the visibility
is low, so try to use radio buttons whenever possible.

<DoDont
  dos={
    'Make the drop down list optional, otherwise specify with a "Required" caption.'
  }
  donts={
    'Use drop down lists when there are less than eight available options.'
  }
/>

### Description of options

Drop down lists are always accompanied with a label and precede a button. Do not use the first
drop down option as a descriptor or label of the list. Instead, it should be the most common or
default option and is part of a set.

<DoDont
  dos={'List the first option as part of a set of related options.'}
  donts={
    'Use the first option as a descriptor or label for the set of options.'
  }
/>
