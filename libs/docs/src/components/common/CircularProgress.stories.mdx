import { Story } from '@storybook/addon-docs';
import { useState, useEffect, useRef } from 'react';

import {
  Tabs,
  Tab,
  CodeSnippet,
  SupportInfo,
  Props,
  Prop,
} from '@abgov/shared/storybook-common';
import { GoAButton, GoACircularProgress } from '@abgov/react-components';

<Meta title="Components/Circular Progress" />

# Circular progress

### A circular progress component provides visual feedback to users after they request an action from the system, e.g., submitting a form, calculating a fee, configuring tables. The progress indicator holds a userâ€™s attention by indicating continued progress while the system loads the appropriate content. The most common progress indicators are either circular or linear.

[Figma design component](https://www.figma.com/file/3pb2IK8s2QUqWieH79KdN7/%E2%9D%96-Components-%7C-DDI?node-id=633%3A12563)

---

export const ProgressTemplate = (args) => {
  const [progress, setProgress] = useState(0);
  const updateProgress = () => {
    return setInterval(() => {
      setProgress(progress + 10);
    }, 1000);
  };
  useEffect(() => {
    const handle = updateProgress();
    return () => {
      clearInterval(handle);
    };
  }, [progress, setProgress]);
  return (
    <GoACircularProgress
      {...args}
      progress={progress}
      type="progress"
      variant="inline"
      visible={true}
      size="large"
    />
  );
};

export const FullscreenTemplate = (args) => {
  const [visible, setVisibility] = useState(false);
  function showProgress() {
    setVisibility(true);
    setTimeout(() => {
      setVisibility(false);
    }, 2000);
  }
  return (
    <>
      <GoAButton type="primary" onClick={showProgress}>
        Show
      </GoAButton>
      <GoACircularProgress
        {...args}
        visible={visible}
        variant="fullscreen"
        size="large"
      />
    </>
  );
};

export const FullscreenProgressTemplate = () => {
  const [progress, setProgress] = useState(0);
  const [visible, setVisibility] = useState(false);
  const handle = useRef(null);
  function show() {
    setVisibility(true);
    startProgress();
  }
  function startProgress() {
    handle.current = setInterval(() => {
      setProgress((p) => {
        return p + 20;
      });
    }, 500);
  }
  useEffect(() => {
    if (progress >= 100) {
      clearInterval(handle.current);
      setVisibility(false);
      setProgress(0);
    }
  }, [progress, handle]);
  return (
    <>
      <GoAButton type="primary" onClick={show}>
        Show
      </GoAButton>
      <GoACircularProgress
        visible={visible}
        variant="fullscreen"
        progress={progress}
        type="progress"
        size="large"
      />
    </>
  );
};

#### Properties

<Props>
  <Prop
    name="type"
    type="infinite | progress"
    required={true}
    description="The type of progress indicator"
  />
  <Prop
    name="variant"
    type="fullscreen | inline"
    required={true}
    description="The variant of progress indicator"
  />
  <Prop
    name="visible"
    type="boolean"
    required={true}
    description="Shows/hides the page loader, allowing for fade transition to be applied in each transition."
  />
  <Prop
    name="size"
    type="small | large"
    required={true}
    description="The size of progress indicator"
  />
  <Prop
    name="progress"
    type="number"
    defaultValue="0"
    description="The progress value"
  />
  <Prop
    name="message"
    type="string"
    defaultValue=""
    description="Text displayed under the circular spinner"
  />
</Props>

#### Basic

<Story name="Basic">
  <GoACircularProgress visible={true} />
</Story>

<Tabs>
  <Tab label="Web Component" hidden={true}>
    <CodeSnippet
      lang="html"
      code={`
      <goa-circular-progress visible />
    `}
    />
  </Tab>
  <Tab label="Angular">
    <CodeSnippet
      lang="html"
      code={`
      <goa-circular-progress [visible]="visible"></goa-circular-progress>
    `}
    />
  </Tab>
  <Tab label="React">
    <CodeSnippet
      lang="tsx"
      code={`
      <GoACircularProgress visible={visible} />
    `}
    />
  </Tab>
</Tabs>

#### Sizes

<Story name="Sizes">
  <GoACircularProgress
    type="infinite"
    variant="inline"
    visible={true}
    message="Loading..."
    size="small"
  />
  <GoACircularProgress
    type="infinite"
    variant="inline"
    visible={true}
    message="Loading..."
    size="large"
  />
</Story>

<Tabs>
  <Tab label="Web Component" hidden={true}>
    <CodeSnippet
      lang="html"
      code={`
      <goa-circular-progress
        type="infinite"
        variant="inline"
        size="small"
        message="Loading..."
        visible />
      <goa-circular-progress
        type="infinite"
        variant="inline"
        size="large"
        message="Loading..."
        visible />
    `}
    />
  </Tab>
  <Tab label="Angular">
    <CodeSnippet
      lang="html"
      code={`
      <goa-circular-progress
        type="infinite"
        variant="inline"
        message="Loading..."
        size="small"
        [visible]="visible">
      </goa-circular-progress>
      <goa-circular-progress
        type="infinite"
        variant="inline"
        message="Loading..."
        size="large"
        [visible]="visible">
      </goa-circular-progress>
    `}
    />
  </Tab>
  <Tab label="React">
    <CodeSnippet
      lang="tsx"
      code={`
      <GoACircularProgress
        type="infinite"
        variant="inline"
        message="Loading..."
        size="small"
        visible={visible} />
      <GoACircularProgress
        type="infinite"
        variant="inline"
        message="Loading..."
        size="large"
        visible={visible} />
    `}
    />
  </Tab>
</Tabs>

#### Message

Message text is optional for all the variations listed.

<Story name="Message">
  <GoACircularProgress
    type="infinite"
    variant="inline"
    visible={true}
    message="Loading..."
    size="large"
  />
</Story>

<Tabs>
  <Tab label="Web Component" hidden={true}>
    <CodeSnippet
      lang="html"
      code={`
      <goa-circular-progress
        type="infinite"
        variant="inline"
        size="large"
        message="Loading..."
        visible />
    `}
    />
  </Tab>
  <Tab label="Angular">
    <CodeSnippet
      lang="html"
      code={`
      <goa-circular-progress
        type="infinite"
        variant="inline"
        size="large"
        message="Loading..."
        [visible]="visible">
      </goa-circular-progress>
    `}
    />
  </Tab>
  <Tab label="React">
    <CodeSnippet
      lang="tsx"
      code={`
      <GoACircularProgress
        type="infinite"
        variant="inline"
        size="large"
        message="Loading..."
        visible={visible} />
    `}
    />
  </Tab>
</Tabs>

#### Inline infinite

<Story name="Inline infinite">
  <GoACircularProgress
    type="infinite"
    variant="inline"
    visible={true}
    size="large"
  />
</Story>

<Tabs>
  <Tab label="Web Component" hidden={true}>
    <CodeSnippet
      lang="html"
      code={`
      <goa-circular-progress type="infinite" variant="inline" size="large" visible />
    `}
    />
  </Tab>
  <Tab label="Angular">
    <CodeSnippet
      lang="html"
      code={`
      <goa-circular-progress
        type="infinite"
        variant="inline"
        size="large"
        [visible]="visible">
      </goa-circular-progress>
    `}
    />
  </Tab>
  <Tab label="React">
    <CodeSnippet
      lang="tsx"
      code={`
      <GoACircularProgress type="infinite" variant="inline" size="large" visible={visible} />
    `}
    />
  </Tab>
</Tabs>

#### Inline progress

<Story name="Inline progress">{ProgressTemplate.bind({})}</Story>

<Tabs>
  <Tab label="Web Component" hidden={true}>
    <CodeSnippet
      lang="html"
      code={`
      <goa-circular-progress id="progress" variant="inline" type="infinite" size="large" visible />
    `}
    />
    <CodeSnippet
      lang="js"
      code={`
      const el = document.getElementById('progress');
      setInterval(() => {
        let p = parseInt(el.getAttribute('progress'));
        p += 10;
        el.setAttribute('progress', p);
        if (p >= 100) {
          el.removeAttribute("visible");
        }
      }, 1000);
    `}
    />
  </Tab>
  <Tab label="Angular">
    <CodeSnippet
      lang="html"
      code={`
      <goa-circular-progress
        type="infinite"
        variant="inline"
        size="large"
        [progress]="progress"
        visible
      </goa-circular-progress>
    `}
    />
    <CodeSnippet
      lang="ts"
      code={`
      export class SomeComponent implements OnInit {
        progress: number = 0;
        ngOnInit() {
          setInterval(() => {
            if (this.progress >= 100) {
              this.progress = 0;
            }
            else {
              this.progress += 10;
            }
          }, 1000);
        }
      }
    `}
    />

  </Tab>
  <Tab label="React">
    <CodeSnippet
      lang="tsx"
      code={`
      export const ProgressTemplate = () => {
        const [progress, setProgress] = useState(0);
        const updateProgress = () => {
          return setInterval(() => {
            setProgress(progress + 10);
          }, 1000);
        };
        useEffect(() => {
          const handle = updateProgress();
          return () => {
            clearInterval(handle);
          };
        }, [progress, setProgress]);
        return <GoACircularProgress type="infinite" progress={progress} variant="inline" size="large" visible={visible} />
      };
    `}
    />
  </Tab>
</Tabs>

#### Fullscreen infinite

<Story name="Fullscreen infinite" args={{ type: 'infinite' }}>
  {FullscreenTemplate.bind({})}
</Story>

<Tabs>
  <Tab label="Web Component" hidden={true}>
    <CodeSnippet
      lang="html"
      code={`
      <goa-circular-progress variant="fullscreen" type="infinite" size="large" visible="true" />
    `}
    />
  </Tab>
  <Tab label="Angular">
    <CodeSnippet
      lang="html"
      code={`
      <goa-circular-progress variant="fullscreen" type="infinite" size="large" visible="true"></goa-circular-progress>
    `}
    />
  </Tab>
  <Tab label="React">
    <CodeSnippet
      lang="tsx"
      code={`
      <GoACircularProgress variant="fullscreen" type="infinite" size="large" visible={visible} />
    `}
    />
  </Tab>
</Tabs>

#### Fullscreen progress

<Story name="Fullscreen progress">
  {FullscreenProgressTemplate.bind({})} }
</Story>

<Tabs>
  <Tab label="Web Component" hidden={true}>
    <CodeSnippet
      lang="html"
      code={`
      <goa-circular-progress variant="fullscreen" type="progress" size="large" visible="true" />
    `}
    />
  </Tab>
  <Tab label="Angular">
    <CodeSnippet
      lang="html"
      code={`
      <goa-circular-progress variant="fullscreen" type="progress" size="large" visible="true"></goa-circular-progress>
    `}
    />
  </Tab>
  <Tab label="React">
    <CodeSnippet
      lang="tsx"
      code={`
      <GoACircularProgress variant="fullscreen" type="progress" size="large" visible={visible} />
    `}
    />
  </Tab>
</Tabs>

---

<SupportInfo />
